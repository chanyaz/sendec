{% extends 'index_new.html' %}
{% load staticfiles %}
{% load my %}
{% load cache %}
{% block current_news %}
    <script>
        function add_like_news(news_id) {
            $.ajax({
                data: {'csrfmiddlewaretoken': '{{ csrf_token }}'},
                type: "POST",
                url: "/news/add_like/n=" + news_id,
                success: $.get("/news/check_like/n=" + news_id).done(function (data) {
                    $(".news_likes_amount_"+news_id).text(data.likes);
                    $(".liked").text("Liked");
                    $(".disliked").text("Dislikes:")
                })
            });
        }
        function reload_likes(){
            var url = location.href.split("/");
            $.get("/news/check_like/n="+url[url.length-2]).done(function(data){
                $(".news_likes_amount_"+url[url.length-2]).text(data.likes);
            });
            return true;
        }
        reload_likes();
        setInterval(reload_likes, 1000);
    </script>
    <script>
        function add_dislike_news(news_id) {
                $.ajax({
                    data: {'csrfmiddlewaretoken': '{{ csrf_token }}'},
                    type: "POST",
                    url: "/news/add_dislike/n=" + news_id,
                    success: $.get("/news/check_dislike/n=" + news_id).done(function (data) {
                        $(".news_dislikes_amount_"+news_id).text(data.dislikes);
                        $(".disliked").text("Disliked");
                        $(".liked").text("Likes:")
                    })
                });
            }
            function reload_dislikes(){
                var url = location.href.split("/");
                $.get("/news/check_dislike/n="+url[url.length-2]).done(function(data){
                    $(".news_dislikes_amount_"+url[url.length-2]).text(data.dislikes);
                });
                return true;
            }
            reload_dislikes();
            setInterval(reload_dislikes, 1000);
    </script>
    <script>
        $(document).ready(function(){
            var $form = $("#comments_form");
            $form.submit(function(){
                $.ajax({
                    type: $form.attr('method'),
                    url: $form.attr('action'),
                    data: $form.serialize(),
                    success: function(result){
                        var window = $('html');//.html("");
                        window.html(result);
                        $($form).find('input[type=text], textarea').val('');
                    },
                    error: function(data){
                        alert("error");
                    }
                });
                return false;
            });
        });
    </script>
    <script>
        $(document).ready(function(){
            function refreshContent(){
                var currentCommentsBlock = $("#comments_block");
                $.get("/news/load="+currentCommentsBlock.attr("data-current-news-id")).done(function(data){
                    var messages = $(".current_comment");
                    data.comments.forEach(function(comment){
                        messages.prepend("SUCCESS COMMENTS LOAD");
                    })
                });
                refreshContent();
                setInterval(refreshContent, 2000);
            }
        });
    </script>
    <script>
        $(document).ready(function(){
            $("img").style.width='100px';
        })
    </script>
    <style>
        .share-list-item{float: left;margin-left: 1%;}
        .container-fluid{border: solid 1px lightgrey;}
        .tre{float: left; width: 70%;}
        .page-header{margin: 0 5%;}
        #translate-button{float: right; border: solid 1px red;}
        .date-and-author{margin-left: 5%;}
        .news-settings{height: 2em; width: 100%;}
        .shares{margin-left: -6%; margin-top: -1%;}
        ul{list-style-type: none;}
        .news-cover{max-width: 100%; max-height: 100%; margin-top: 0; height: 400px; background: url('/media/{{ current_news_values.news_main_cover }}') no-repeat center; background-size: cover;}
        .news-post-text{margin: 0 15%;}
        .news-post-text-translate{margin: 0 15%;}
        .nav-bar{margin-left: 63%;}
        .liked{float: left;}
        .disliked{float: left;}
        .other-materials{height: {% if other_materials|length <= 3 %} 25em {% elif other_materials|length <= 6 %} 52em {% elif other_materials|length <= 9 %} 77em {% elif other_materials|length <= 12 %} 103em {% endif %}}
        .portal{float: left;}
        .current-rss-news{width: 32%; height: 25em; margin-left: 1%; margin-top: 1%; float: left;}
        .news-image{background: url('/media/{{ current_other.news_main_cover }}') no-repeat center; width: 100%; height: 50%;}
        .right-side-block{width: 28%; float: right;}
        .latest-news{border: 1px solid blue; box-shadow: 2px 2px 2px rgba(0,0,0,5);}
        .latest-news-cover{float: left; height:70px; width: 100px; background: url('/media/{{ i.news_main_cover }}') no-repeat center; background-size: cover;}
        .time{color: blue;}
        .latest-news{height: 70px;}
        .latest-header{text-align: center;}
    </style>
    <div class="container-fluid" data-news-id="{{ current_news_values.id }}">
        <div class="tre">
            <h1 class="page-header">
                {{ current_news_values.news_title }}
            </h1>
            <button id="translate-button"
                    onclick="$('.news-post-text').fadeOut();
                        $('.news-post-text-translate').delay(100).show();">Translate</button>
            <div class="date-and-author">
                <h5>By
                    {% if current_news_values.id|get_news_portal == "SEVERY" %}
                        <a href="/search/?q={{ current_news_values.news_author }}">{{ current_news_values.news_author_id|get_article_author }}</a>
                    {% else %}
                        <a href="/search/?q={{ current_news_values.news_portal_name }}">{{ current_news_values.news_portal_name }}</a>
                    {% endif %}
                    &nbsp;{{ current_news_values.news_post_date.date }}</h5>
            </div>
        {% cache 600 news-settings %}
        <div class="news-settings">
            <div class="shares">
                <ul>
                    <li class="share-list-item">
                        <div class="fb-share-button" data-layout="button"></div>
                    </li>
                    <li class="share-list-item">
                        <span class="share-vk">
                            <script type="text/javascript">
                                document.write(VK.Share.button(false,{type: "round_nocount", text: "Share on VK", eng: 1}));
                            </script>
                        </span>
                    </li>
                    <li class="share-list-item">
                        <span class="share-twitter">
                            <a href="https://twitter.com/share" class="twitter-share-button"{count} data-via="InsydiaNews">Tweet</a>
                            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                        </span>
                    </li>
                    <li class="share-list-item">
                        <span class="share-linkedin">
                            <script src="//platform.linkedin.com/in.js" type="text/javascript"> lang: en_US</script>
                            <script type="IN/Share" data-counter=""></script>
                        </span>
                    </li>
                </ul>
            </div>
        </div>
        {% endcache %}
            {% if current_news_values.news_main_cover != '' %}
                <div class="news-cover">
                </div>
            {% endif %}
            <div class="news-post-text">
                {{ current_news_values.news_post_text|safe|linebreaks }}
            </div>
            <div class="news-post-text-translate" hidden>
                {{ current_news_values.news_post_text_translate|safe|linebreaks }}
            </div>
            <div class="nav-bar">
                <ul class="list-inline">
                    <li>
                        <span data-news-id="{{ current_news_values.id }}"
                              class="news_likes"
                              id="add_like_{{ current_news_values.id }}"
                              onclick="add_like_news('{{ current_news_values.id }}');">
                            <div class="liked">
                                {% if liked == False %}
                                    Likes:
                                {% else %}
                                    <span
                                        data-news-id="{{ current_news_values.id }}"
                                        class="break_like"
                                        id="break_like_{{ current_news_values.id }}"
                                        onclick="">Liked</span>
                                {% endif %}
                            </div>
                        </span>&nbsp;
                        <span class="news_likes_amount_{{ current_news_values.id }}">
                            {{ like_amount }}
                        </span>
                    </li>&nbsp;|
                    <li>
                        <span
                                data-news-id="{{ current_news_values.id }}"
                                class="news_dislikes"
                                id="add_dislike_{{ current_news_values.id }}"
                                onclick="add_dislike_news('{{ current_news_values.id }}');">
                            <div class="disliked">
                                {% if disliked == False %}
                                    Dislikes:
                                {% else %}
                                    <!-- Break dislike -->
                                    <span
                                        data-news-id="{{ current_news_values.id }}"
                                        class="break_dislike"
                                        id="break_dislike_{{ current_news_values.id }}"
                                        onclick="">Disliked</span>
                                {% endif %}
                            </div>
                        </span>&nbsp;
                        <span class="news_dislikes_amount_{{ current_news_values.id }}">
                            {{ dislike_amount }}
                        </span>
                    </li>&nbsp;|
                    <li>
                        {% if current_news_values.news_post_date.day < current_day %}
                            {{ current_news_values.news_post_date.date }}
                        {% else %}
                            {{ current_news_values.news_post_date.time }}
                        {% endif %}
                    </li>
                </ul>
            </div>
            {% if other_materials|length > 0 %}
                <hr width="100%">
                Other&nbsp;materials&nbsp;of&nbsp;{{ current_news_values.news_category }}
                <div class="other-materials">
                    {% for current_other in other_materials %}
                        <div id="current_rss_news_{{ i.id }}"
                             class="current-rss-news">
                                <div class="title"><a href="/news/{{ current_other.news_category_id }}/{{ current_other.id }}/">{{ current_other.news_title }}</a></div>
                                <div class="portal">By <a href="/search/?q={{ current_other.news_portal_name_id|get_portal_name }}">{{ current_other.news_portal_name_id|get_portal_name }}</a></div>
                                <div class="published">&nbsp;|&nbsp;{{ current_other.news_post_date.time }}</div>

                                <div class="news-image">

                                </div>

                                <div class="description">{{ current_other.post_text|safe|striptags|truncatewords:"9" }}</div>
                            </div>
                    {% endfor %}
                </div>
            {% endif %}
            <hr width="100%">
            <div id="comments-block">
                <div id="disqus_thread"></div>
                <script>
                    (function(){
                        var d = document, s = d.createElement('script');
                        s.src = '//indavant.disqus.com/embed.js';
                        s.setAttribute('data-timestamp', +new Date());
                        (d.head || d.body).appendChild(s);
                    })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
            </div>
        </div>
        <div class="right-side-block">
            <div class="latest-news">
                <div class="latest-header">
                    News&nbsp;of&nbsp;{{ company_name }}
                </div>
                <div class="latest-titles">
                    {% for i in latest_news %}
                        <div class="latest-news"
                             onclick="location.href='/news/{{ i.news_category_id }}/{{ i.id }}/';">
                            <div class="latest-news-cover">
                            </div>
                            <div class="latest-news-content">
                                <span class="time">
                                    {{ i.news_post_date.time }}
                                </span>
                                <span class="title"
                                      onmouseover="this.style.color='blue'; style.cursor='pointer';"
                                      onmouseout="this.style.color='black';"
                                      onclick="location.href='/news/{{ i.news_category_id }}/{{ i.id }}/';">
                                    {{ i.news_title }}
                                </span>
                            </div>
                        </div>
                        <hr>
                    {% endfor %}
                </div>
            </div>
            <div class="video-and-subs">
                {% include 'twitter.html' %}
            </div>
        </div>
    </div>
{% endblock %}
