{% extends 'index_beta.html' %}
{% load i18n %}
{% load my %}
{% load thumbnail %}
{% load staticfiles %}
{% block browse_portals %}

    <style>
        .private-top{position:relative;margin-top:-2%;width:100%;height:400px}
        .private-top-background{position:absolute;width:100%;height:400px;background:url('{% static 'static/img/rss/top-back-12jpg' %}') no-repeat center;opacity: 1}
        .private-top-content{position:absolute;height:100%}
        .private-top-title{margin-top:1%}
        .private-top-title>h1{color:ivory}
        .private-top-search{margin-top:5%;}
        #bottom-counter{position:absolute;bottom:0}
        #bottom-counter>h4{color:ivory}
        .current-popular-portal{width:24%;height:200px;float:left;margin-right:5px;margin-bottom:15px}
        .mobile-current-popular-portal{height: 210px}
        .portal-picture{width:100%;height:150px}
        .mobile-portal-picture{width:100%;height:120px}
        .portal-name{position:absolute;bottom:0}
        .portal-bottom{position:absolute;bottom:5%;width:100%}
        .portal-footer{position:absolute;bottom:0}
        .portal-link>h3{font-size:16px;color:#F62A00}
        #left-control-portals{position:fixed;overflow-y:scroll;overflow-x:hidden;z-index:989;height:100%;margin-top: -5.5%;float: left;width: 16.1%;left: 0}
        #browser{width:100%;float:right;position:relative;min-height:300px}
        #browser-main-title{width:100%;text-align:center;font-family:Georgia,Times,"Times New Roman",serif;font-size:16px}
        #browser-middle{width:100%;border:solid 1px red}
        .category-main-title{position:relative;width:100%;font-family:Georgia,Times,"Times New Roman",serif;font-size:16px;color:white;text-align:center}
        #success-follow{visibility:hidden;z-index:999;top:0;width:100%;height:100%;position:fixed}
        #sf-content{background:white;width:30%;height:20%;position:absolute;top:40%;left:35%}
        #fadeandscale{background: white;width: 50%;height: 90%;overflow-y: scroll;-webkit-transform: scale(0.8);-moz-transform: scale(0.8);-ms-transform: scale(0.8);transform: scale(0.8)}
        .popup_visible #fadeandscale {-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);transform: scale(1)}
        .cur-pw-item>li{width:100%;height:inherit;margin-bottom:15px}
        .cur-pw-ar-cover{float:left;width:30%}
        .cur-pw-ar-content{float:right;width:70%}
        .cont-cover{width:100%;height:100px;float:left}
        .cont-cover:hover{cursor:pointer}
        .cur-pw-td{color:white;}
        .cur-pw-right{top:80%;color:white;position:absolute;text-align:center}
        .cur-pw-left{width:100%;padding:0 5%;margin-top:2%;font-family:Georgia,Times,sans-serif;font-size:17px}
        .cur-pw-left img{max-height:800px;max-width:100%;height:inherit;margin-left:auto !important;margin-right:auto !important}
        .cur-pw-top{position:relative;}
        .cur-pw-cover{width:100%;height:150px}
        .fl-btn{width:100%}
        .cur-pw-background{width:100%;height:200px;background:url('{% static 'static/img/rss/top-back-12jpg' %}') no-repeat center;background-size:cover}
        .cur-pw-btn-fl{position:absolute;bottom:0;right:0}
        .cur-pw-btn-bck{position:absolute;bottom:0;left:0}
        .rss-popular{margin-top:50px}
    </style>
    <script>
        function hideCurrentRssPortal(){
            $('#fadeandscale').popup('hide');
            $('#fadeandscale-mobile').popup('hide');
        }
        function showCurrentPortalNews(portal){
            $('#ajax-preloader').show();
            $.ajax({
                method: "POST",
                url: "/news/usernews/page/"+portal,
                data:{csrfmiddlewaretoken: "{{ csrf_token }}"},
                success: function(data){
                    $('#browser').html(data);
                    $('#ajax-preloader').hide();
                },
                error: function(result){
                    alert("Oh,"+portal+"'s news have been broken. Try later, please.\nWe are working on this problem.");
                    $('#ajax-preloader').hide();
                }
            })
        }
    </script>
    <div class="private-top">
        <div class="private-top-background"></div>
        <div class="private-top-content col-md-12">
            <div class="private-top-title text-center col-md-12">
                <h1>Pick your own collection of news</h1>
            </div>
            <div class="private-top-search col-md-6">
                <div class="form-group col-md-12 col-md-offset-6">
                    <input id="uap" name="url" type="search" class="form-control" placeholder="{% trans 'What would you like to read?' %}">
                </div>
            </div>
            <div class="text-center col-md-12">
                <h3>or <a href="/news/catalog/">browse catalog</a></h3>
            </div>
            <div id="bottom-counter" class="text-center col-md-12">
                <h4>{{ portals_count }}&nbsp;portals&nbsp;|&nbsp;{{ channels_count }}&nbsp;RSS&nbsp;channels&nbsp;|&nbsp;5&nbsp;Categories</h4>
            </div>
        </div>
    </div>
    <div class="container-fluid container browser">
        <div class="row row-centered">
            <div id="browser">
                <div class="most-popular-portals col-md-12 col-xs-12">
                    <div class="most-populsr-title text-center">
                        <h2>Most popuar portals</h2>
                    </div>
                    <div class="most-rss-portals-list col-xs-12">
                        {% for i in most_popular %}
                            {% if flavour != 'mobile' %}
                            <div onclick="showCurrentPortalData('{{ i.id }}'); return false;" class="fadeandscale_open current-popular-portal col-md-2" id="portal-{{ i.id }}" data-alt-id="{{ i.puid }}">
                            {% else %}
                                <div onclick="showCurrentPortalData('{{ i.id }}'); return false;" class="col-xs-6 fadeandscale_open mobile-current-popular-portal col-md-2" id="portal-{{ i.id }}" data-alt-id="{{ i.puid }}">
                            {% endif %}
                                <a href="">
                                {% if flavour != 'mobile' %}
                                    <div class="portal-picture" style="background: url('{{ i.cover }}') no-repeat center; background-size: cover;"></div>
                                {% else %}
                                    <div class="mobile-portal-picture" style="background: url('{{ i.cover }}') no-repeat center; background-size: cover;"></div>
                                {% endif %}
                                </a>
                            {% if flavour != 'mobile' %}
                                <div class="portal-bottom">
                            {% else %}
                                <div class="mobile-portal-bottom">
                            {% endif %}
                                    <span class="portal-logo">{{ i.favicon }}</span>
                                    {% if flavour != 'mobile' %}
                                        <span class="portal-name">
                                    {% else %}
                                        <span class="mobile-portal-name">
                                    {% endif %}
                                        <a href="" class="portal-link">
                                            <h3>{{ i.portal }}</h3>
                                        </a>
                                    </span>
                                </div>
                            {% if flavour != 'mobile' %}
                                <div class="portal-footer">
                            {% else %}
                                <div class="mobile-portal-footer">
                            {% endif %}
                                    <span class="">Followers:&nbsp;{{ i.follows }}</span>&nbsp;|&nbsp;
                                    <span class="">Articles:&nbsp;{{ i.id|rss_articles_amount }}</span>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="most-popular-technology rss-popular col-xs-12">
                    <div class="most-populsr-title text-center">
                        <h2>Technology</h2>
                    </div>
                    <div class="most-technology-rss-portals-list col-xs-12">
                        {% for i in rss_tech %}
                            {% if flavour != 'mobile' %}
                            <div onclick="showCurrentPortalData('{{ i.id }}'); return false;" class="fadeandscale_open current-popular-portal col-md-2" id="portal-{{ i.id }}" data-alt-id="{{ i.puid }}">
                            {% else %}
                                <div onclick="showCurrentPortalData('{{ i.id }}'); return false;" class="col-xs-6 fadeandscale_open mobile-current-popular-portal col-md-2" id="portal-{{ i.id }}" data-alt-id="{{ i.puid }}">
                            {% endif %}
                                <a href="">
                                {% if flavour != 'mobile' %}
                                    <div class="portal-picture" style="background: url('{{ i.cover }}') no-repeat center; background-size: cover;"></div>
                                {% else %}
                                    <div class="mobile-portal-picture" style="background: url('{{ i.cover }}') no-repeat center; background-size: cover;"></div>
                                {% endif %}
                                </a>
                            {% if flavour != 'mobile' %}
                                <div class="portal-bottom">
                            {% else %}
                                <div class="mobile-portal-bottom">
                            {% endif %}
                                    <span class="portal-logo">{{ i.favicon }}</span>
                                    {% if flavour != 'mobile' %}
                                        <span class="portal-name">
                                    {% else %}
                                        <span class="mobile-portal-name">
                                    {% endif %}
                                        <a href="" class="portal-link">
                                            <h3>{{ i.portal }}</h3>
                                        </a>
                                    </span>
                                </div>
                            {% if flavour != 'mobile' %}
                                <div class="portal-footer">
                            {% else %}
                                <div class="mobile-portal-footer">
                            {% endif %}
                                    <span class="">Followers:&nbsp;{{ i.follows }}</span>&nbsp;|&nbsp;
                                    <span class="">Articles:&nbsp;{{ i.id|rss_articles_amount }}</span>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="most-popular-entertainment rss-popular col-xs-12">
                    <div class="most-populsr-title text-center">
                        <h2>Entertainment</h2>
                    </div>
                    <div class="most-rss-portals-list col-xs-12">
                        {% for i in rss_ent %}
                            {% if flavour != 'mobile' %}
                            <div onclick="showCurrentPortalData('{{ i.id }}'); return false;" class="fadeandscale_open current-popular-portal col-md-2" id="portal-{{ i.id }}" data-alt-id="{{ i.puid }}">
                            {% else %}
                                <div onclick="showCurrentPortalData('{{ i.id }}'); return false;" class="col-xs-6 fadeandscale_open mobile-current-popular-portal col-md-2" id="portal-{{ i.id }}" data-alt-id="{{ i.puid }}">
                            {% endif %}
                                <a href="">
                                {% if flavour != 'mobile' %}
                                    <div class="portal-picture" style="background: url('{{ i.cover }}') no-repeat center; background-size: cover;"></div>
                                {% else %}
                                    <div class="mobile-portal-picture" style="background: url('{{ i.cover }}') no-repeat center; background-size: cover;"></div>
                                {% endif %}
                                </a>
                            {% if flavour != 'mobile' %}
                                <div class="portal-bottom">
                            {% else %}
                                <div class="mobile-portal-bottom">
                            {% endif %}
                                    <span class="portal-logo">{{ i.favicon }}</span>
                                    {% if flavour != 'mobile' %}
                                        <span class="portal-name">
                                    {% else %}
                                        <span class="mobile-portal-name">
                                    {% endif %}
                                        <a href="" class="portal-link">
                                            <h3>{{ i.portal }}</h3>
                                        </a>
                                    </span>
                                </div>
                            {% if flavour != 'mobile' %}
                                <div class="portal-footer">
                            {% else %}
                                <div class="mobile-portal-footer">
                            {% endif %}
                                    <span class="">Followers:&nbsp;{{ i.follows }}</span>&nbsp;|&nbsp;
                                    <span class="">Articles:&nbsp;{{ i.id|rss_articles_amount }}</span>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="most-popular-auto rss-popular col-xs-12">
                    <div class="most-populsr-title text-center">
                        <h2>Auto portals</h2>
                    </div>
                    <div class="most-rss-portals-list col-xs-12">
                        {% for i in rss_auto %}
                           {% if flavour != 'mobile' %}
                            <div onclick="showCurrentPortalData('{{ i.id }}'); return false;" class="fadeandscale_open current-popular-portal col-md-2" id="portal-{{ i.id }}" data-alt-id="{{ i.puid }}">
                            {% else %}
                                <div onclick="showCurrentPortalData('{{ i.id }}'); return false;" class="col-xs-6 fadeandscale_open mobile-current-popular-portal col-md-2" id="portal-{{ i.id }}" data-alt-id="{{ i.puid }}">
                            {% endif %}
                                <a href="">
                                {% if flavour != 'mobile' %}
                                    <div class="portal-picture" style="background: url('{{ i.cover }}') no-repeat center; background-size: cover;"></div>
                                {% else %}
                                    <div class="mobile-portal-picture" style="background: url('{{ i.cover }}') no-repeat center; background-size: cover;"></div>
                                {% endif %}
                                </a>
                            {% if flavour != 'mobile' %}
                                <div class="portal-bottom">
                            {% else %}
                                <div class="mobile-portal-bottom">
                            {% endif %}
                                    <span class="portal-logo">{{ i.favicon }}</span>
                                    {% if flavour != 'mobile' %}
                                        <span class="portal-name">
                                    {% else %}
                                        <span class="mobile-portal-name">
                                    {% endif %}
                                        <a href="" class="portal-link">
                                            <h3>{{ i.portal }}</h3>
                                        </a>
                                    </span>
                                </div>
                            {% if flavour != 'mobile' %}
                                <div class="portal-footer">
                            {% else %}
                                <div class="mobile-portal-footer">
                            {% endif %}
                                    <span class="">Followers:&nbsp;{{ i.follows }}</span>&nbsp;|&nbsp;
                                    <span class="">Articles:&nbsp;{{ i.id|rss_articles_amount }}</span>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="most-popular-space rss-popular col-xs-12">
                    <div class="most-populsr-title text-center">
                        <h2>Space portals</h2>
                    </div>
                    <div class="most-rss-portals-list col-xs-12">
                        {% for i in rss_space %}
                            {% if flavour != 'mobile' %}
                            <div onclick="showCurrentPortalData('{{ i.id }}'); return false;" class="fadeandscale_open current-popular-portal col-md-2" id="portal-{{ i.id }}" data-alt-id="{{ i.puid }}">
                            {% else %}
                                <div onclick="showCurrentPortalData('{{ i.id }}'); return false;" class="col-xs-6 fadeandscale_open mobile-current-popular-portal col-md-2" id="portal-{{ i.id }}" data-alt-id="{{ i.puid }}">
                            {% endif %}
                                <a href="">
                                {% if flavour != 'mobile' %}
                                    <div class="portal-picture" style="background: url('{{ i.cover }}') no-repeat center; background-size: cover;"></div>
                                {% else %}
                                    <div class="mobile-portal-picture" style="background: url('{{ i.cover }}') no-repeat center; background-size: cover;"></div>
                                {% endif %}
                                </a>
                            {% if flavour != 'mobile' %}
                                <div class="portal-bottom">
                            {% else %}
                                <div class="mobile-portal-bottom">
                            {% endif %}
                                    <span class="portal-logo">{{ i.favicon }}</span>
                                    {% if flavour != 'mobile' %}
                                        <span class="portal-name">
                                    {% else %}
                                        <span class="mobile-portal-name">
                                    {% endif %}
                                        <a href="" class="portal-link">
                                            <h3>{{ i.portal }}</h3>
                                        </a>
                                    </span>
                                </div>
                            {% if flavour != 'mobile' %}
                                <div class="portal-footer">
                            {% else %}
                                <div class="mobile-portal-footer">
                            {% endif %}
                                    <span class="">Followers:&nbsp;{{ i.follows }}</span>&nbsp;|&nbsp;
                                    <span class="">Articles:&nbsp;{{ i.id|rss_articles_amount }}</span>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="most-popular-bio rss-popular col-xs-12">
                    <div class="most-populsr-title text-center">
                        <h2>Bio-engineer portals</h2>
                    </div>
                    <div class="most-rss-portals-list col-xs-12">
                        {% for i in rss_bio %}
                            {% if flavour != 'mobile' %}
                            <div onclick="showCurrentPortalData('{{ i.id }}'); return false;" class="fadeandscale_open current-popular-portal col-md-2" id="portal-{{ i.id }}" data-alt-id="{{ i.puid }}">
                            {% else %}
                                <div onclick="showCurrentPortalData('{{ i.id }}'); return false;" class="col-xs-6 fadeandscale_open mobile-current-popular-portal col-md-2" id="portal-{{ i.id }}" data-alt-id="{{ i.puid }}">
                            {% endif %}
                                <a href="">
                                {% if flavour != 'mobile' %}
                                    <div class="portal-picture" style="background: url('{{ i.cover }}') no-repeat center; background-size: cover;"></div>
                                {% else %}
                                    <div class="mobile-portal-picture" style="background: url('{{ i.cover }}') no-repeat center; background-size: cover;"></div>
                                {% endif %}
                                </a>
                            {% if flavour != 'mobile' %}
                                <div class="portal-bottom">
                            {% else %}
                                <div class="mobile-portal-bottom">
                            {% endif %}
                                    <span class="portal-logo">{{ i.favicon }}</span>
                                    {% if flavour != 'mobile' %}
                                        <span class="portal-name">
                                    {% else %}
                                        <span class="mobile-portal-name">
                                    {% endif %}
                                        <a href="" class="portal-link">
                                            <h3>{{ i.portal }}</h3>
                                        </a>
                                    </span>
                                </div>
                            {% if flavour != 'mobile' %}
                                <div class="portal-footer">
                            {% else %}
                                <div class="mobile-portal-footer">
                            {% endif %}
                                    <span class="">Followers:&nbsp;{{ i.follows }}</span>&nbsp;|&nbsp;
                                    <span class="">Articles:&nbsp;{{ i.id|rss_articles_amount }}</span>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                {% if flavour != 'mobile' %}
                    <div id="fadeandscale" class="fadeandscale"><div class="cur-pw-content"></div></div>
                {% else %}
                    <div id="fadeandscale-mobile" class="fadeandscale"><div class="cur-pw-content-mobile"></div></div>
                {% endif %}

            </div>
        </div>
    </div>


    <script src="//cdn.rawgit.com/vast-engineering/jquery-popup-overlay/1.7.11/jquery.popupoverlay.js"></script>
     <script>
        function changeStatePortals(element){
            if (!$(element).parent().hasClass('active')) {
                $(element).parent().addClass('active');
            }
            else {
                $(element).parent().removeClass('active');
            }
        }
                    {% if flavour != 'mobile' %}
                    function showCurrentPortalData(i) {
                        $.ajax({
                            type: "POST",
                            url: "/news/preview_portal="+i+"/",
                            data: {"csrfmiddlewaretoken": "{{ csrf_token }}"},
                            success: function (data) {
                                $('#fadeandscale').popup({
                                    autoopen: true,
                                    pagecontainer: '.container',
                                    transition: 'all 0.3s'
                                });
                                $('.cur-pw-content').html(data.data).replace('{by}', "{% trans 'By' %}");
                            }
                        })
                    }
                    {% else %}
                    function showCurrentPortalData(i) {
                        $.ajax({
                            type: "POST",
                            url: "/news/preview_portal_m="+i+"/",
                            data: {"csrfmiddlewaretoken": "{{ csrf_token }}"},
                            success: function (data) {
                                $('#fadeandscale-mobile').popup({
                                    autoopen: true,
                                    pagecontainer: '.container',
                                    transition: 'all 0.3s'
                                }).css({
                                    'background': 'white'
                                });
                                $('.cur-pw-content-mobile').html(data.data).replace('{by}', "{% trans 'By' %}");

                            }
                        })
                    }
                    {% endif %}

        function loadCurrentArticle(i){
            $.ajax({
                type: "POST",
                data: {"csrfmiddlewaretoken": "{{ csrf_token }}"},
                url: "/news/gcr="+i+"/",
                success: function(data){
                    $('#fadeandscale').animate({
                        scrollTop: 0
                    });
                    $parsedData = data.data;
                    $('.cur-pw-description').html("<h1 style='font-size: 25px;' class='text-center'>"+$parsedData.title+"</h1>");
                    if ($parsedData.content.length === 0) {
                        $(".cur-pw-left").html($parsedData.text + "<hr width='100%'><p style='text-align: center;'><a href='" + $parsedData.link + "'><button style='width: 30%;  background-color: #1E656D; color: ivory;' class='btn btn-to-original'>See&nbsp;original</button></a>");
                    }
                    else {
                        $(".cur-pw-left").html($parsedData.content + "<hr width='100%'><p style='text-align: center;'><a href='" + $parsedData.link + "'><button style='width: 30%; margin-bottom: 20px; background-color: #1E656D; color: ivory;' class='btn btn-to-original'>See&nbsp;original</button></a>");
                    }
                    $('.cur-pw-btn-bck').html('<button onclick="showCurrentPortalData('+$parsedData.portal+');" class="btn btn-primary">Back</button>');
                    $('.cur-pw-btn-fl').html('<a href="'+$parsedData.link+'" target="_blank"><button class="btn btn-primary">Original</button></a>');
                    $('.cur-pw-right').html('By '+'<span class="rss-author-name">'+$parsedData.author+'</span> | '+$parsedData.date);
                }
            })
        }

    function followCurrentRssPortal(uuid,pid, id){
        $.ajax({
            url: "/news/arp&uid=" + uuid + "&pid=" + id + "/",
            type: "POST",
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function (data) {
                alertify.success("{% trans 'Subscription added' %}");
                $('.cur-pw-btn-fl').html('<button class="btn-fl-rss btn btn-primary" onclick="unfollowCurrentRssPortal(\'{uuid}\', \'{id}\', \'{id}\'); return false;">Unfollow</button>'
                        .replace("{uuid}", data.uuid)
                        .replace("{id}", data.id)
                        .replace("{id}", data.id));
            }
        })
    }
    function unfollowCurrentRssPortal(uuid, pid, id){
        $.ajax({
            url: "/news/rrp&uid="+uuid+"&pid="+id+"/",
            type: "POST",
            data:{"csrfmiddlewaretoken": "{{ csrf_token }}"},
            success: function(data){
                alertify.error("{% trans 'Subscription remove' %}");
                $('.cur-pw-btn-fl').html('<button class="btn-fl-rss btn btn-primary" onclick="followCurrentRssPortal(\'{uuid}\', \'{id}\', \'{id}\'); return false;">Follow</button>'
                        .replace("{uuid}", data.uuid)
                        .replace("{id}", data.id)
                        .replace("{id}", data.id));
            }
        })
    }
    </script>
{% endblock %}