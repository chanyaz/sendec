{% extends 'index_new.html' %}
{% load i18n %}
{% load my %}
{% load thumbnail %}
{% load staticfiles %}
{% block browse_portals %}

    <style>
    #left-control-portals{
            position: fixed;
            overflow-y: scroll;
            overflow-x: hidden;
            z-index: 989;
            height: 100%;
            margin-top: -5.5%;
            float: left;
            width: 16.1%;
            left: 0;
    }



        #browser{
            width: 82%;
            float: right;
            position: relative;
            min-height: 300px;
        }


        #browser-main-title{
            width: 100%;
            text-align: center;
            font-family: Georgia, Times, "Times New Roman", serif;
            font-size: 16px;
        }

        #browser-middle{
            width: 100%;
            border: solid 1px red;
        }

        .category-main-title{
            position: relative;
            width: 100%;
            font-family:Georgia, Times, "Times New Roman", serif;
            font-size: 16px;
            color: white;
            text-align: center;
        }

{##}
{#        .current_rss_news{#}
{#            width: 20%;#}
{#            height: 20em;#}
{#            margin-left: 1%;#}
{#            margin-top: 1%;#}
{#            border-radius: 5px;#}
{#            box-shadow: 0 0 5px black;#}
{#            float: left;#}
{#            background-color: white;#}
{#            opacity: 0.7;#}
{#        }#}
    </style>

    <script>

        function showCurrentPortalNews(portal){
            $('#ajax-preloader').show();
            $.ajax({
                method: "POST",
                url: "/news/usernews/page/"+portal,
                data:{csrfmiddlewaretoken: "{{ csrf_token }}"},
                success: function(data){
                    $('#browser').html(data);
                    $('#ajax-preloader').hide();
                },
                error: function(result){
                    alert("Oh,"+portal+"'s news have been broken. Try later, please.\nWe are working on this problem.");
                    $('#ajax-preloader').hide();
                }
            })
        }


        function followCurrentRssPortal(uuid,pid, id){
            $("#ajax-preloader").show();
            $.ajax({
                url: "/news/arp&uid="+uuid+"&pid="+pid+"/",
                type: "POST",
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(result){
                    if(result.exists == false) {
                        $("#left-bar-portal-" + id).slideToggle();
                        var table = $('.user-rss');
{#                        var string = '<li id="left-bar-portal-{portal_id}"><a>' +#}
{#                                '<span class="cprs" onclick="showCurrentPortalNews(' + '{portal_verbose}' + ');">' +#}
{#                                '{portal_name}</span>' +#}
{#                                '<span class="count"></span></a>' + '</li><br>';#}
                        {#                    alert(string);#}
                        table.append(result.string.replace('{portal_id}', result.data.id)
                                .replace('{favicon}', result.data.favicon)
                                .replace('{portal_verbose}', result.data.verbose)
                                .replace('{portal_name}', result.data.portal));

                        var scrollTo = $('#left-bar-portal-'+result.data.id).offset().top;
                        $('#left-control-portals').animate({scrollTop: scrollTo});
                        $('#left-bar-portal-'+result.data.id).animate({backgroundColor: 'rgb(25, 180, 155)'}, 2000).animate({backgroundColor: '#1C1F22'}, 2000);

{#                        $(".browser").load("/news/browser/");#}
                        $("#ajax-preloader").hide();
                    }
                    else{
                        alert('Already exists');
                        $("#ajax-preloader").hide();
                    }
                }
            })
        }

    </script>

    <div class="container-fluid container browser">
        <div class="row row-centered">
            <div id="left-control-portals">
                <main class="cd-main-content">
                    <nav class="cd-side-nav-2">
                        <ul>
                            <li id="left-panel-main-title" style="z-index:919; color: white; text-align: center; font-family: Georgia, Times, 'Times New Roman', serifs">
                                <a href="/" style="font-size: 30px">INSYDIA</a>
                            </li>
                        </ul>
                        <ul>
                            <li class="cd-label">{% trans 'Main' %}</li>
                            <li class="has-children overview active" onclick="changeStatePortals(this);">
                                <a href="#">{% trans 'Overview' %}</a>
                                <ul>
                                    <li><a href="/news/usernews/">{% trans 'My feed' %}</a></li>
                                    <li><a href="/favourite/">{% trans 'Saved articles' %}</a></li>
                                </ul>
                            </li>
                        <li>
                            <li class="has-children overview active" onclick="changeStatePortals(this);">
                                <a href="">{% trans 'Properties' %}</a>
                                <ul>
                                    <li class="cd-label">Show type</li>
                                    <li><a href="">blocks</a></li>
                                    <li><a href="">list</a></li>
                                    <li><a href="">Show readed</a></li>
                                </ul>
                            </li>
                        </li>
                            <li id="side-bar-portals" class="has-children notifications active">
                                <a id="side-bar-portals-link" href="#" onclick="changeStatePortals(this);">{% trans 'Portals' %}</a>

                                <ul class="user-rss">
                                    {% for current_portal in user_rss_portals %}
                                        <li id="left-bar-portal-{{ current_portal.id }}"><a>
                                            <span class="cprs" onclick="showCurrentPortalNews('{{ current_portal.portal_id|get_rss_verbose_name }}');">
                                                {{ current_portal.portal_id|get_rss_portal_name }}
                                            </span>
                                            {% if current_portal.portal_id|get_unread_news:username.id != 0 %}
                                                <span id="cprs-count-{{ current_portal.id }}" class="count">{{ current_portal.portal_id|get_unread_news:username.id|default:'' }}</span>
                                            {% endif %}
                                            </a>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </li>
                        </ul>
                        <ul style="margin-bottom: 50px;">
                            <li class="cd-label">{% trans 'Configures' %}</li>
                            <li class="has-children bookmarks">
                                <a href="/news/manager/"><span class="glyphicon glyphicon-cog"></span>{% trans 'Manage portals' %}</a>
                                <a href="/news/browser/"><span class="glyphicon glyphicon-plus-sign"></span>{% trans 'Browse portals' %}</a>
                            </li>
                        </ul>
                    </nav>
                </main>
            </div>




            <div id="browser">

                    <div id="browser-main-title">
                        <h2>{% trans 'Pick your own collection of news' %}</h2>
                    </div>

                <div id="add-user-portal" style="width:80%; margin-left: auto; margin-right: auto; margin-bottom: 50px;">


                <div class="google-news-below-shares" style="margin-left: auto; margin-right: auto; width:728px; height: 90px; background-color: #00fff9;"></div>


                    <input name="user_portal"
                           type="text"
                           id="uap"
                           data-target="#processing-modal"
                           placeholder="{% trans 'Drop the key word or link' %}"
                           class="form-control"
                           style="width:100%; z-index: 9999; margin-left: 0;">




                    <div id="processing-portals" class="progress progress-striped active" hidden>
                      <div class="progress-bar progress-bar-danger"  role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
                        <span class="sr-only">{% trans 'Loading...' %}</span>
                          {% trans 'Wait please' %}
                      </div>
                    </div>



                    <div hidden id="search-feed-fail">
                        {% trans "Sorry, we can't work with this portal. Try another one or search by key-word." %}
                    </div>
                    <div id="found-feed" hidden style="text-align: center;">
                        {% trans 'We find RSS-channel on' %} <span id="user-url"></span> {% trans 'and add it to our Database.' %}
                        <br>Thanks a lot!<br>
                        <p>Feed:&nbsp;<span id="user-url-feed" style="font-weight: bold;"></span>
                        <p>Enjoy Reading!
                    </div>
                    <div id="new-portal-block">
                        {% trans 'We are collecting news for current portals. Wait please. Or you can read the latest news almost now by click' %}
                        <a href="">{% trans 'here' %}</a>.

                            <div id="new-portal-feed-feed">

                        </div>

                    </div>
                 <div hidden id="preview-portal" style="margin-top:15px; width: 350px; margin-left: auto; margin-right: auto; height: 300px;">
{#                    <div id="preview-portal-content" style="border: solid 1px lightgrey; border-radius: 5px;">#}
{#                        <div id="ppc-cover" style="width: 350px; height: 150px; background: url('{{ test.cover }}') no-repeat center; background-size: cover;"></div>#}
{#                        <div id="ppc-name"><b>{{ test.portal }}</b></div>#}
{#                        <div id="ppc-description"><i>{{ test.description }}</i></div>#}
{#                        <div id="ppc-params">Followers:&nbsp;{{ test.follows }}</div>#}
{#                        <div id="ppc-follow">#}
{#                            <button class="btn btn-success">Follow</button>#}
{#                        </div>#}
{#                    </div>#}
                 </div>
            </div>




                    <div id="browser-middle">

                        <div id="browser-categories">

                            <ul class="browse-categories-list">
                                <li class="browse-cat">
                                    <a href="/news/browser/tech/">
                                        <div class="browse-cat-top"></div>
                                        <div class="homepage-hero-module-top-browse">
                                            <div class="video-container-browse">
                                                <div class="title-container">
                                                    <div class="headline">
                                                            <h1>{% trans 'Technology' %}</h1>
                                                    </div>
                                                    <div class="description">
                                                        <div class="inner">
                                                            <a href=""></a>
                                                        </div>
                                                    </div>
                                                </div>
                                {#                <div class="filter"></div>#}
                                                <video autoplay loop class="fillWidth" poster="{% static 'static/img/companies_logo/spacex.png' %}">
{#                                                    <source src="{% static 'static/video/falcon9.mp4' %}" type="video/mp4"/>Your browser does not support the video tag. I suggest you upgrade your browser.</video>#}
                                                <div class="poster hidden">
                                                    <img src="" alt="">
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li class="browse-cat">
                                    <a href="">
                                        <div class="browse-cat-top"></div>
                                        <div class="homepage-hero-module-top-browse">
                                            <div class="video-container-browse">
                                                <div class="title-container">
                                                    <div class="headline">
                                                            <h1>{% trans 'Entertainment' %}</h1>
                                                    </div>
                                                    <div class="description">
                                                        <div class="inner">
                                                            <a href=""></a>
                                                        </div>
                                                    </div>
                                                </div>
                                {#                <div class="filter"></div>#}
                                                <video autoplay loop class="fillWidth" poster="{% static 'static/img/companies_logo/spacex.png' %}">
{#                                                    <source src="{% static 'static/video/falcon9.mp4' %}" type="video/mp4"/>Your browser does not support the video tag. I suggest you upgrade your browser.</video>#}
                                                <div class="poster hidden">
                                                    <img src="" alt="">
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li class="browse-cat">
                                    <a href="">
                                        <div class="browse-cat-top"></div>
                                        <div class="homepage-hero-module-top-browse">
                                            <div class="video-container-browse">
                                                <div class="title-container">
                                                    <div class="headline">
                                                            <h1>{% trans 'Auto' %}</h1>
                                                    </div>
                                                    <div class="description">
                                                        <div class="inner">
                                                            <a href=""></a>
                                                        </div>
                                                    </div>
                                                </div>
                                {#                <div class="filter"></div>#}
                                                <video autoplay loop class="fillWidth" poster="{% static 'static/img/companies_logo/spacex.png' %}">
{#                                                    <source src="{% static 'static/video/falcon9.mp4' %}" type="video/mp4"/>Your browser does not support the video tag. I suggest you upgrade your browser.</video>#}
                                                <div class="poster hidden">
                                                    <img src="" alt="">
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li class="browse-cat">
                                    <a href="">
                                        <div class="browse-cat-top"></div>
                                        <div class="homepage-hero-module-top-browse">
                                            <div class="video-container-browse">
                                                <div class="title-container">
                                                    <div class="headline">
                                                            <h1>{% trans 'Spase' %}</h1>
                                                    </div>
                                                    <div class="description">
                                                        <div class="inner">
                                                            <a href=""></a>
                                                        </div>
                                                    </div>
                                                </div>
                                {#                <div class="filter"></div>#}
                                                <video autoplay loop class="fillWidth" poster="{% static 'static/img/companies_logo/spacex.png' %}">
{#                                                    <source src="{% static 'static/video/falcon9.mp4' %}" type="video/mp4"/>Your browser does not support the video tag. I suggest you upgrade your browser.</video>#}
                                                <div class="poster hidden">
                                                    <img src="" alt="">
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li class="browse-cat">
                                    <a href="">
                                        <div class="browse-cat-top"></div>
                                        <div class="homepage-hero-module-top-browse">
                                            <div class="video-container-browse">
                                                <div class="title-container">
                                                    <div class="headline">
                                                            <h1>{% trans 'Bio-technology' %}</h1>
                                                    </div>
                                                    <div class="description">
                                                        <div class="inner">
                                                            <a href=""></a>
                                                        </div>
                                                    </div>
                                                </div>
                                {#                <div class="filter"></div>#}
                                                <video autoplay loop class="fillWidth" poster="{% static 'static/img/companies_logo/spacex.png' %}">
{#                                                    <source src="{% static 'static/video/falcon9.mp4' %}" type="video/mp4"/>Your browser does not support the video tag. I suggest you upgrade your browser.</video>#}
                                                <div class="poster hidden">
                                                    <img src="" alt="">
                                                </div>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                            </ul>


{#                            <div id="browser-technology">#}
{#                                <div class="category-main-title"><h2 style="color: white;">TECHNOLOGY</h2></div>#}
{#                                {% for i in rss_tech %}#}
{#                                    <div class="rss_portal_preview"#}
{#                                         id="rss_id_"#}
{#                                         data-indx=""#}
{#                                         onclick=""#}
{#                                         data-current-rss-news-id="">#}
{#                                        <div class="rss_tech_cover"#}
{#                                             style="width: 100%;#}
{#                                                     height: 150px;#}
    {#                                                 {% if i.cover != '[]' %}#}
{#                                                        background: url('{{ i.cover }}') no-repeat center;#}
    {#                                                 {% endif %}#}
{#                                                     background-size: cover;">#}
    {#                                        <img src="{{ i.cover }}" width="100%" height="150px"/>#}
{#                                        </div>#}
{#                                        <div class="rss_tech_middle">#}
{#                                            <div class="rss_tech_title"><b>{{ i.portal }}</b></div>#}
{#                                            <div class="rss_tech_description"><i>{{ i.description|safe|truncatechars:100 }}</i></div>#}
{#                                            <div class="rss_tech_configs">Followers:&nbsp;{{ i.follows }}</div>#}
{#                                        </div>#}
{#                                        <div class="rss_tech_btn" style="width:100%;">#}
{#                                            <button class="btn btn-success"#}
{#                                                    onclick="followCurrentRssPortal('{{ username.profile.uuid }}','{{ i.id }}', '{{ i.id }}')"#}
{#                                                    style="width:100%;">{% trans 'Follow' %}</button>#}
{#                                        </div>#}
{#                                    </div>#}
{#                                {% endfor %}#}
{#                                <div class="rss_tech_all">#}
{#                                    Show more#}
{#                                </div>#}
{#                            </div>#}
{#                            <div id="browser-entertainment">#}
{#                                <div class="category-main-title"><h2 style="color: white;">ENTERTAINMENT</h2></div>#}
{#                                 {% for i in rss_ent %}#}
{#                                    <div class="rss_portal_preview"#}
{#                                         id="rss_id_"#}
{#                                         data-indx=""#}
{#                                         onclick=""#}
{#                                         data-current-rss-news-id="">#}
{#                                        <div class="rss_ent_cover"#}
{#                                             style="width: 100%;#}
{#                                                     height: 150px;#}
    {#                                                 {% if i.cover != '[]' %}#}
{#                                                        background: url('{{ i.cover }}') no-repeat center;#}
    {#                                                 {% endif %}#}
{#                                                     background-size: cover;">#}
    {#                                        <img src="{{ i.cover }}" width="100%" height="150px"/>#}
{#                                        </div>#}
{#                                        <div class="rss_tech_middle">#}
{#                                            <div class="rss_tech_title"><b>{{ i.portal }}</b></div>#}
{#                                            <div class="rss_tech_description"><i>{{ i.description|safe|truncatechars:100 }}</i></div>#}
{#                                            <div class="rss_tech_configs">Followers:&nbsp;{{ i.follows }}</div>#}
{#                                        </div>#}
{#                                        <div class="rss_tech_btn" style="width:100%;">#}
{#                                            <button class="btn btn-success"#}
{#                                                    onclick="followCurrentRssPortal('{{ username.profile.uuid }}','{{ i.id }}', '{{ i.id }}')"#}
{#                                                    style="width:100%;">{% trans 'Follow' %}</button>#}
{#                                        </div>#}
{#                                    </div>#}
{#                                {% endfor %}#}
{#                                <div class="rss_tech_all">#}
{#                                    Show more#}
{#                                </div>#}
{#                            </div>#}
{#                            <div id="browser-auto">#}
{#                                <div class="category-main-title"><h2 style="color: white;">AUTO</h2></div>#}
{#                                 {% for i in rss_auto %}#}
{#                                    <div class="rss_portal_preview"#}
{#                                         id="rss_id_"#}
{#                                         data-indx=""#}
{#                                         onclick=""#}
{#                                         data-current-rss-news-id="">#}
{#                                        <div class="rss_auto_cover"#}
{#                                             style="width: 100%;#}
{#                                                     height: 150px;#}
    {#                                                 {% if i.cover != '[]' %}#}
{#                                                        background: url('{{ i.cover }}') no-repeat center;#}
    {#                                                 {% endif %}#}
{#                                                     background-size: cover;">#}
    {#                                        <img src="{{ i.cover }}" width="100%" height="150px"/>#}
{#                                        </div>#}
{#                                        <div class="rss_tech_middle">#}
{#                                            <div class="rss_tech_title"><b>{{ i.portal }}</b></div>#}
{#                                            <div class="rss_tech_description"><i>{{ i.description|safe|truncatechars:100 }}</i></div>#}
{#                                            <div class="rss_tech_configs">Followers:&nbsp;{{ i.follows }}</div>#}
{#                                        </div>#}
{#                                        <div class="rss_tech_btn" style="width:100%;">#}
{#                                            <button class="btn btn-success"#}
{#                                                    onclick="followCurrentRssPortal('{{ username.profile.uuid }}','{{ i.id }}', '{{ i.id }}')"#}
{#                                                    style="width:100%;">{% trans 'Follow' %}</button>#}
{#                                        </div>#}
{#                                    </div>#}
{#                                {% endfor %}#}
{#                                <div class="rss_tech_all">#}
{#                                    Show more#}
{#                                </div>#}
{#                            </div>#}
{#                            <div id="browser-space">#}
{#                                <div class="category-main-title"><h2 style="color: white;">SPACE</h2></div>#}
{#                                 {% for i in rss_space %}#}
{#                                    <div class="rss_portal_preview"#}
{#                                         id="rss_id_"#}
{#                                         data-indx=""#}
{#                                         onclick=""#}
{#                                         data-current-rss-news-id="">#}
{#                                        <div class="rss_space_cover"#}
{#                                             style="width: 100%;#}
{#                                                     height: 150px;#}
    {#                                                 {% if i.cover != '[]' %}#}
{#                                                        background: url('{{ i.cover }}') no-repeat center;#}
    {#                                                 {% endif %}#}
{#                                                     background-size: cover;">#}
    {#                                        <img src="{{ i.cover }}" width="100%" height="150px"/>#}
{#                                        </div>#}
{#                                        <div class="rss_tech_middle">#}
{#                                            <div class="rss_tech_title"><b>{{ i.portal }}</b></div>#}
{#                                            <div class="rss_tech_description"><i>{{ i.description|safe|truncatechars:100 }}</i></div>#}
{#                                            <div class="rss_tech_configs">Followers:&nbsp;{{ i.follows }}</div>#}
{#                                        </div>#}
{#                                        <div class="rss_tech_btn" style="width:100%;">#}
{#                                            <button class="btn btn-success"#}
{#                                                    onclick="followCurrentRssPortal('{{ username.profile.uuid }}','{{ i.id }}', '{{ i.id }}')"#}
{#                                                    style="width:100%;">{% trans 'Follow' %}</button>#}
{#                                        </div>#}
{#                                    </div>#}
{#                                {% endfor %}#}
{#                                <div class="rss_tech_all">#}
{#                                    Show more#}
{#                                </div>#}
{#                            </div>#}
{#                            <div id="browser-bio">#}
{#                            <div class="category-main-title"><h2 style="color: white;">BIO TECHNOLOGY</h2></div>#}
{#                             {% for i in rss_bio %}#}
{#                                <div class="rss_portal_preview"#}
{#                                     id="rss_id_"#}
{#                                     data-indx=""#}
{#                                     onclick=""#}
{#                                     data-current-rss-news-id="">#}
{#                                    <div class="rss_bio_cover"#}
{#                                         style="width: 100%;#}
{#                                                 height: 150px;#}
{#                                                 {% if i.cover != '[]' %}#}
{#                                                    background: url('{{ i.cover }}') no-repeat center;#}
{#                                                 {% endif %}#}
{#                                                 background-size: cover;">#}
{#                                        <img src="{{ i.cover }}" width="100%" height="150px"/>#}
{#                                    </div>#}
{#                                    <div class="rss_tech_middle">#}
{#                                        <div class="rss_tech_title"><b>{{ i.portal }}</b></div>#}
{#                                        <div class="rss_tech_description"><i>{{ i.description|safe|truncatechars:100 }}</i></div>#}
{#                                        <div class="rss_tech_configs">Followers:&nbsp;{{ i.follows }}</div>#}
{#                                    </div>#}
{#                                    <div class="rss_tech_btn" style="width:100%;">#}
{#                                        <button class="btn btn-success"#}
{#                                                onclick="followCurrentRssPortal('{{ username.profile.uuid }}','{{ i.id }}', '{{ i.id }}')"#}
{#                                                style="width:100%;">{% trans 'Follow' %}</button>#}
{#                                    </div>#}
{#                                </div>#}
{#                            {% endfor %}#}
{#                            <div class="rss_tech_all">#}
{#                                Show more#}
{#                            </div>#}
{#                        </div>#}
                        </div>
                    </div>
                </div>









        </div>
    </div>

    <div class="usernews-footer" style="margin-left: 16.1%;
    width: 83.9%;
    border: solid 1px red;">
        {% include 'footer_usernews.html' %}
    </div>

     <script>
        function changeStatePortals(element){
            if (!$(element).parent().hasClass('active')) {
                $(element).parent().addClass('active');
            }
            else {
                $(element).parent().removeClass('active');
            }
        }
    </script>

{% endblock %}